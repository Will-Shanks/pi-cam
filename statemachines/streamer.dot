digraph {

  s_a_start->s_s [label="New Thread", color=blue]
  s_s->s_c [label="Connection established"]
  s_c->s_close [label="Connection Terminated"]
  s_close->s_s

  s_a_stop->s_d [label="Signal Thread", style=dashed, color=red]
  s_d->d [color=red]

  s_a_s_fps->s_restart [label="If new FPS != old FPS, Signal Thread", style=dashed]

  s_a_s_res->s_restart [label="If new RES != old RES, Signal Thread", style=dashed]

  s_s [label="Listen for UDP connection on port S_PORT"]
  s_c [label="Record and Stream over connection"]
  s_restart [label="Restart Recording with current S_FPS and S_RES"]
  s_d [label="Close Socket"]
  s_close [label="Clean up Connection"]

  d [label="Kill Thread", style=filled, fillcolor=grey]

  subgraph cluster_s_a {
    label="Streamer API"
      s_a_g_fps [label="Return S_FPS", shape=box]
      s_a_s_fps [label="Set S_FPS", shape=box]
      s_a_g_res [label="Return S_RES", shape=box]
      s_a_s_res [label="Set S_RES", shape=box]
      s_a_stop [label="Stop", shape=box]
      s_a_start [label="Start", shape=box]
  }
}
